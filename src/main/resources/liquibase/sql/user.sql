--liquibase formatted sql

--changeset vikhtiiarov:1
CREATE TABLE IF NOT EXISTS user_custodian
(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY ,
    user_id BIGINT                     NOT NULL ,
    full_name TEXT                     NOT NULL ,
    contacts TEXT                      NOT NULL ,
    custody_date TIMESTAMP             NOT NULL ,
    volunteer TEXT                     NOT NULL
);
--changeset dmitry:1
CREATE TABLE IF NOT EXISTS trial_period
(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY ,
    start_date TIMESTAMP                     NOT NULL ,
    end_date TIMESTAMP                     NOT NULL ,
    volunteer TEXT                     NOT NULL,
    parent_id BIGINT  NOT NULL REFERENCES user_custodian(id)
);

--changeset vikhtiiarov:2
CREATE TABLE animal
(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY ,
    animal_type TEXT                   NOT NULL ,
    nickname    TEXT                   NOT NULL ,
    availability_animal  BOOLEAN       NOT NULL
);

CREATE TABLE report
(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY ,
    date_adoption TIMESTAMP                 NOT NULL ,
    foto BYTEA                         NOT NULL ,
    diet TEXT                          NOT NULL ,
    wellbeing TEXT                     NOT NULL ,
    behaviour TEXT                     NOT NULL
);

--changeset daniilK:1
ALTER TABLE report ADD parent_id BIGINT NOT NULL REFERENCES user_custodian(id);
ALTER TABLE report RENAME COLUMN date_adoption TO report_date;

--changeset daniilK:2
ALTER TABLE report ALTER COLUMN report_date TYPE DATE;

--changeset vikhtiiarov:3
ALTER TABLE  user_custodian DROP COLUMN volunteer ;
ALTER TABLE  user_custodian DROP COLUMN custody_date ;
ALTER TABLE  user_custodian RENAME COLUMN user_id TO user_chat_id;

ALTER TABLE  trial_period DROP COLUMN parent_id;
ALTER TABLE trial_period ADD COLUMN animal_id BIGINT  NOT NULL REFERENCES animal(id) ;
ALTER TABLE trial_period ALTER COLUMN start_date TYPE DATE;
ALTER TABLE trial_period ALTER COLUMN end_date TYPE DATE;
ALTER TABLE trial_period ADD user_id BIGINT  NOT NULL REFERENCES user_custodian(id) ;
ALTER TABLE report RENAME COLUMN parent_id TO user_id ;

--changeset vikhtiiarov:4
CREATE TABLE volunteer
(
    id             BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    volunteer_name TEXT              NOT NULL ,
    chat_id        BIGINT            NOT NULL ,
    available      BOOLEAN           NOT NULL
);



